<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Rasberry Pi Ultraschall-Entfernungsmesser by Blog404DE</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Rasberry Pi Ultraschall-Entfernungsmesser</h1>
        <h2>Ultraschall Entfernungsmesser auf Basis eines Raspberry Pi</h2>
        <a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="entfernung-messen-mit-raspberrypi" class="anchor" href="#entfernung-messen-mit-raspberrypi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Entfernung messen mit RaspberryPi</h1>

<h2>
<a id="einleitung" class="anchor" href="#einleitung" aria-hidden="true"><span class="octicon octicon-link"></span></a>Einleitung:</h2>

<p>Diese Anleitung beschreibt, wie man mit wenigen Bauteilen und einem RaspberryPi einen Ultraschall-basierenden Entfernungsmesser baut.</p>

<h3>
<a id="bauteil-liste" class="anchor" href="#bauteil-liste" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bauteil-Liste:</h3>

<ul>
<li>1x RaspberryPi B, B+ oder 2 (inkl. Netzteil, SD bzw. MicroSD Karte, Tastatur) - ca. 60 Eur </li>
<li>1x Steckplatine (Breadboard small+ oder full+) - ca. 8 Eur</li>
<li>1x Steckbrücken-Set für die Steckplatine - ca. 5 Eur</li>
<li>1x Set mit Male-Female Steckbrücken (Jumper Wires)¹ - ca. 5 Eur</li>
<li>1x Ultraschall Messmodul HC-SR04 - ca. 5 Eur</li>
<li>1x Widerstand mit 330Ω - ca. 2 Eur</li>
<li>1x Widerstand mit 470Ω - ca. 2 Eur</li>
</ul>

<p>¹ Alternativ zu den Male-Female Steckbrücken kann auch ein Breadboard-Adapter für die Verbindung zum RaspberryPi verwendet werden - ca. 8 Eur</p>

<p><strong>Gesamtkosten:</strong> Die Kosten für alle benötigten Bauteile betragen ca. 80 bis 90 Eur. </p>

<p>Bei den angegebenen Preise handelt es sich um Durchschnittspreise für Deutschland zum Zeitpunkt der Erstellung des Tutorials. Die benötigten Teile sollten sich bei den meisten Elektronik-Händler, die auch ein RaspberryPi im Sortiment führen, zu finden sein.</p>

<h3>
<a id="funktionsweise" class="anchor" href="#funktionsweise" aria-hidden="true"><span class="octicon octicon-link"></span></a>Funktionsweise:</h3>

<p>Ziel des Aufbaus ist es, die Entfernung zu einem Gegenstand mittels Ultraschall-Impuls zu ermitteln. Verwendet wird hierfür das Ultraschall-Messmodul <a href="http://www.mikrocontroller.net/attachment/218122/HC-SR04_ultraschallmodul_beschreibung_3.pdf">HC-SR04</a>. Das Modul ist dabei in der Lage eine Entfernungsmessung im Bereich 2cm bis ~3 Meter durchzuführen mit einer Genauigkeit von ±3mm. </p>

<p>Da Ultraschall durch Gegenstände reflektiert wird, kann mittels der Zeit zwischen absenden und empfangen des Schall die Entfernung berechnet werden. Bei einer Lufttemperatur von 20°C breitet sich Ultraschall 343,5 m/s aus, sodass mittels folgender Formel die Entfernung berechnet werden kann:</p>

<blockquote>
<p>Distanz [cm] = (Signallaufzeit [Sek] / 2) * 34350 [cm/sek]</p>
</blockquote>

<h2>
<a id="aufbau-der-hardware" class="anchor" href="#aufbau-der-hardware" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aufbau der Hardware:</h2>

<h3>
<a id="hc-sr04-ultraschall-sensor" class="anchor" href="#hc-sr04-ultraschall-sensor" aria-hidden="true"><span class="octicon octicon-link"></span></a>HC-SR04 Ultraschall-Sensor:</h3>

<p><img src="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/raw/master/Bilder/HC-SR04.jpg" alt="Ultraschall Sensor"> </p>

<h6>
<a id="anschlüsse" class="anchor" href="#anschl%C3%BCsse" aria-hidden="true"><span class="octicon octicon-link"></span></a>Anschlüsse:</h6>

<ol>
<li>Vcc (+5V)</li>
<li>Trigger</li>
<li>Echo</li>
<li>Gnd</li>
</ol>

<p>Auf Vcc liegt die +5V Versorgungsspannung und bei Gnd die Masse an. Über "Trigger" wird der Ultraschall-Impuls ausgelöst und über Echo erfolgt die Signalisierung des erfolgreichen Empfang des Ultraschall-Echos. </p>

<h3>
<a id="aufbau-der-schaltung" class="anchor" href="#aufbau-der-schaltung" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aufbau der Schaltung:</h3>

<p>Die 4 PINs des Ultraschall-Moduls müssen wie folgt mit dem RaspberryPi verbunden werden:</p>

<ul>
<li>Vcc an Pin 2 (Vcc +5V)</li>
<li>GND an Pin 6 (GND) </li>
<li>TRIG an Pin 12 (GPIO 18)</li>
<li>An ECHO wird der 330Ω Widerstand angeschlossen. Vom Ende des Widerstands geht eine Verbindung zu Pin 18 (GPIO 24) und über den 470Ω eine Verbindung zu Pin 6 (GND).</li>
</ul>

<h5>
<a id="bitte-unbedingt-beachten" class="anchor" href="#bitte-unbedingt-beachten" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bitte unbedingt beachten:</h5>

<p>Das HC-SR04 Modul darf auf keinen Fall direkt mit dem RaspberryPi verbunden werden. Das Ultraschall-Modul arbeitet mit einer Spannung von 5v, während die GPIO Ports des RaspberryPi nur 3.3V vertragen. Ohne einen Spannungsteiler am ECHO-Ausgang wird beim RaspberryPi daher der GPIO Eingang zerstört. Aus diesem Grund ist unbedingt der Widerstand R1 mit 330Ω notwendig. </p>

<h3>
<a id="schaltbild-auf-dem-steckboard-breadboard" class="anchor" href="#schaltbild-auf-dem-steckboard-breadboard" aria-hidden="true"><span class="octicon octicon-link"></span></a>Schaltbild auf dem Steckboard (Breadboard):</h3>

<p><img src="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/raw/master/Schaltplan/Schaltplan.png" alt="Breadboard"> </p>

<p>Downloads-URLs für den Schaltplan in verschiedene Formate: </p>

<ul>
<li><a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/raw/master/Schaltplan/Schaltplan.pdf">PDF Datei</a></li>
<li><a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/raw/master/Schaltplan/Schaltplan.fzz">Fritzing</a></li>
</ul>

<h2>
<a id="aufbau-der-software" class="anchor" href="#aufbau-der-software" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aufbau der Software</h2>

<p>Für den Raspberry wird empfiehlt sich Raspbian als System zu verwenden, welches über z.B. über <a href="https://www.raspberrypi.org/downloads/">NOOB</a> installiert werden kann. Mittels eines Python-Scripts  kann die Messung durchgeführt werden.</p>

<h4>
<a id="python-script-getdistancepy" class="anchor" href="#python-script-getdistancepy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Python-Script "getDistance.py"</h4>

<div class="highlight highlight-python"><pre><span class="pl-c">#!/usr/bin/env python</span>
<span class="pl-c"># -*- coding: utf-8 -*-</span>

<span class="pl-c"># Entfernungsmesser für RaspberryPi</span>
<span class="pl-c"># Version 1.0</span>
<span class="pl-c">#</span>
<span class="pl-c"># Copyright: tfnApps.de Jens Dutzi</span>
<span class="pl-c"># Datum: 27.06.2015</span>
<span class="pl-c"># Lizenz: MIT Lizenz (siehe LICENSE)</span>
<span class="pl-c"># -----------------------------------</span>


<span class="pl-c"># import required modules</span>
<span class="pl-k">import</span> time
<span class="pl-k">import</span> RPi.GPIO <span class="pl-k">as</span> GPIO

<span class="pl-c"># define GPIO pins</span>
GPIOTrigger <span class="pl-k">=</span> <span class="pl-c1">18</span>
GPIOEcho    <span class="pl-k">=</span> <span class="pl-c1">24</span>

<span class="pl-c"># Funktion zum messen der Entfernung</span>
<span class="pl-k">def</span> <span class="pl-en">MesseDistanz</span>():
    <span class="pl-c"># Trigger auf "high" setzen (Signal senden)</span>
    GPIO.output(GPIOTrigger, <span class="pl-c1">True</span>)

    <span class="pl-c"># Signal für 10µs senden (ggf. je nach RaspberryPi auf 0.0005 setzen)</span>
    time.sleep(<span class="pl-c1">0.00001</span>)

    <span class="pl-c"># Trigger auf "low setzen (Signal beenden)</span>
    GPIO.output(GPIOTrigger, <span class="pl-c1">False</span>)

    <span class="pl-c"># Aktuelle Zeit setzen</span>
    StartZeit <span class="pl-k">=</span> time.time()
    StopZeit <span class="pl-k">=</span> StartZeit

    <span class="pl-c"># Warte bis "Echo" auf "low" gesetzt wird und setze danach Start-Zeit erneut</span>
    <span class="pl-k">while</span> GPIO.input(GPIOEcho) <span class="pl-k">==</span> <span class="pl-c1">0</span>:
        StartZeit <span class="pl-k">=</span> time.time()

    <span class="pl-c"># Warte bis "Echo" auf "high" wechselt (Signal wird empfangen) und setze End-Zeit</span>
    <span class="pl-k">while</span> GPIO.input(GPIOEcho) <span class="pl-k">==</span> <span class="pl-c1">1</span>:
        StopZeit <span class="pl-k">=</span> time.time()

    <span class="pl-c"># Abstand anhand der Signal-Laufzeit berechnen</span>
    <span class="pl-c"># Schallgeschwindigkeit: 343,50 m/s (bei 20°C Lufttemperatur)</span>
    <span class="pl-c"># Formel: /Signallaufzeit in Sekunden * Schallgeschwindigket in cm/s) / 2 (wg. Hin- und Rückweg des Signals)</span>
    SignalLaufzeit <span class="pl-k">=</span> StopZeit <span class="pl-k">-</span> StartZeit
    Distanz <span class="pl-k">=</span> (SignalLaufzeit<span class="pl-k">/</span><span class="pl-c1">2</span>) <span class="pl-k">*</span> <span class="pl-c1">34350</span>

    <span class="pl-k">return</span> [Distanz, (SignalLaufzeit<span class="pl-k">*</span><span class="pl-c1">1000</span><span class="pl-k">/</span><span class="pl-c1">2</span>)]

<span class="pl-c"># main function</span>
<span class="pl-k">def</span> <span class="pl-en">main</span>():
    <span class="pl-k">try</span>:
        <span class="pl-k">while</span> <span class="pl-c1">True</span>:
            Ergebnis <span class="pl-k">=</span> MesseDistanz()
            <span class="pl-k">print</span>(<span class="pl-s"><span class="pl-pds">"</span>Gemessene Entfernung: <span class="pl-c1">%.1f</span> cm (Signallaufzeit: <span class="pl-c1">%.4f</span>ms)<span class="pl-pds">"</span></span> <span class="pl-k">%</span> (Ergebnis[<span class="pl-c1">0</span>], Ergebnis[<span class="pl-c1">1</span>]))
            time.sleep(<span class="pl-c1">1</span>)

    <span class="pl-c"># reset GPIO settings if user pressed Ctrl+C</span>
    <span class="pl-k">except</span> <span class="pl-c1">KeyboardInterrupt</span>:
        <span class="pl-k">print</span>(<span class="pl-s"><span class="pl-pds">"</span>Messung abgebrochen<span class="pl-pds">"</span></span>)
        GPIO.cleanup()

<span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
    <span class="pl-c"># benutze GPIO Pin Nummerierung-Standard (Broadcom SOC channel)</span>
    GPIO.setmode(GPIO.BCM)

    <span class="pl-c"># Initialisiere GPIO Ports</span>
    GPIO.setup(GPIOTrigger, GPIO.OUT)
    GPIO.setup(GPIOEcho, GPIO.IN)

    <span class="pl-c"># Setze GPIO Trigger auf false</span>
    GPIO.output(GPIOTrigger, <span class="pl-c1">False</span>)

    <span class="pl-c"># Main-Funktion starten</span>
    main()</pre></div>

<p>Download: <a href="https://raw.githubusercontent.com/Blog404DE/RasPiUltraschallEntfernungsmesser/master/Code/getDistance.py">getDistance.py</a></p>

<h3>
<a id="wie-führe-ich-eine-messung-aus" class="anchor" href="#wie-f%C3%BChre-ich-eine-messung-aus" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wie führe ich eine Messung aus?</h3>

<p>Nachdem Sie das Script auf Ihren RaspberryPi geladen haben, können Sie es direkt mittels folgendem Befehl aufrufen:</p>

<blockquote>
<p>python getDistance.py</p>
</blockquote>

<p>Alternativ können Sie getDistance.py auch direkt ausführbar machen und sich das "python" beim aufrufen sparen. Hierzu ist nur folgendes notwendig:</p>

<blockquote>
<p>chmod +x getDistance.py</p>
</blockquote>

<p>Das Programm ermittelt kontinuierlich den Abstand und kann mittels <em>STRG+C</em> beendet werden. </p>

<hr>

<p><strong>Lizenz-Information:</strong></p>

<p>Copyright Jens Dutzi 2015 / Stand: 28.06.2015</p>

<p>Dieses Werk ist lizenziert unter der <a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/blob/master/LICENSE">MIT Lizenz</a>.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser"></a> is maintained by <a href="https://github.com/Blog404DE">Blog404DE</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>

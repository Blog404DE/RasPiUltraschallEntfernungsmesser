<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Rasberry Pi Ultraschall-Entfernungsmesser by Blog404DE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Rasberry Pi Ultraschall-Entfernungsmesser</h1>
      <h2 class="project-tagline">Ultraschall Entfernungsmesser auf Basis eines Raspberry Pi</h2>
      <a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser" class="btn">View on GitHub</a>
      <a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="entfernung-messen-mit-raspberrypi" class="anchor" href="#entfernung-messen-mit-raspberrypi" aria-hidden="true"><span class="octicon octicon-link"></span></a>Entfernung messen mit RaspberryPi</h1>

<h2>
<a id="einleitung" class="anchor" href="#einleitung" aria-hidden="true"><span class="octicon octicon-link"></span></a>Einleitung:</h2>

<p>Diese Anleitung beschreibt, wie man mit wenigen Bauteilen und einem RaspberryPi einen Ultraschall-basierenden Entfernungsmesser baut.</p>

<h3>
<a id="raspberry-pi-basis" class="anchor" href="#raspberry-pi-basis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Raspberry Pi Basis:</h3>

<ul>
<li>1x RaspberryPi 2 (<a href="http://amzn.to/1HWR3hM">Amazon</a>)</li>
<li>1x MicroUSB-Netzteil (~2A) (<a href="http://amzn.to/1Cxknv6">Amazon</a>)</li>
<li>1x 8 oder 16GB MicroSD Karte (<a href="http://amzn.to/1KZHwZT">Amazon</a>)</li>
<li>1x USB-Tastatur oder USB Tastatur/Maus Kombi (<a href="http://amzn.to/1KZHLUF">Amazon</a>)</li>
</ul>

<p>Alternativ kann auch ein Vorgänger-Modell des RaspberryPi 2 verwendet werden. Hierfür wird anstatt einer MicroSD eine SD Card benötigt. Im Prinzip kann jede USB Tastatur verwendet werden.</p>

<p>Dieses Set dient als Basis für praktisch alle Raspberry Pi Projekte. Der RaspberryPi 2 bietet gegenüber seinen Vorgänger-Modellen u.a. eine höhere CPU Geschwindigkeit, mehr Arbeitsspeicher und 4 anstatt 2 USB Anschlüsse. Je nach Projekt kann dies durchaus von Vorteil sein. </p>

<h3>
<a id="bauteil-liste-für-den-entfernungsmesser" class="anchor" href="#bauteil-liste-f%C3%BCr-den-entfernungsmesser" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bauteil-Liste für den Entfernungsmesser:</h3>

<ul>
<li>1x Steckplatine / Breadboard small+ oder full+ (<a href="http://amzn.to/1HVmfOs">Amazon</a>)</li>
<li>1x Steckbrücken-Set für die Steckplatine (<a href="http://amzn.to/1HokKqB">Amazon</a>)</li>
<li>1x Set mit Male-Female Steckbrücken (Jumper Wires)¹ (<a href="http://amzn.to/1HWMDHV">Amazon</a>)</li>
<li>1x Ultraschall Messmodul HC-SR04 (<a href="http://amzn.to/1HWMp3j">Amazon</a>)</li>
<li>Widerstände mit 1x330Ω und 1x470Ω (z.B. im großen durchmischten Set bei <a href="http://B009K6JLSM">Amazon</a>, ansonsten einzeln bei <a href="http://www.reichelt.de/">Reichelt</a>, <a href="http://www.conrad.de/">Conrad</a> oder <a href="http://www.elv.de/">ELV</a>)</li>
</ul>

<p>¹ Alternativ zu den Male-Female Steckbrücken kann auch ein Breadboard-Adapter für die Verbindung zum RaspberryPi verwendet werden</p>

<p><em>Hinweis zu den Amazon-Links:</em> Alle Artikel-Links beinhalten Amazon Partner-Links. Mit der Bestellung über diese Links unterstützen Sie dieses Blog und erlauben uns weitere RaspberryPi Projekte hier zu veröffentlichen.</p>

<h3>
<a id="funktionsweise" class="anchor" href="#funktionsweise" aria-hidden="true"><span class="octicon octicon-link"></span></a>Funktionsweise:</h3>

<p>Ziel des Aufbaus ist es, die Entfernung zu einem Gegenstand mittels Ultraschall-Impuls zu ermitteln. Verwendet wird hierfür das Ultraschall-Messmodul <a href="http://www.mikrocontroller.net/attachment/218122/HC-SR04_ultraschallmodul_beschreibung_3.pdf">HC-SR04</a>. Das Modul ist dabei in der Lage eine Entfernungsmessung im Bereich 2cm bis ~3 Meter durchzuführen mit einer Genauigkeit von ±3mm. </p>

<p>Da Ultraschall durch Gegenstände reflektiert wird, kann mittels der Zeit zwischen absenden und empfangen des Schall die Entfernung berechnet werden. Bei einer Lufttemperatur von 20°C breitet sich Ultraschall 343,5 m/s aus, sodass mittels folgender Formel die Entfernung berechnet werden kann:</p>

<blockquote>
<p>Distanz [cm] = (Signallaufzeit [Sek] / 2) * 34350 [cm/sek]</p>
</blockquote>

<p>Bei der Formel stellt sich vielleicht die Frage, warum eigentlich die Signallaufzeit halbiert wird. Wenn wir uns das Script genau anschauen, wird die Laufzeit des Signals direkt beim absenden des Ultraschall-Pulses angefangen zu messen und hört auf, sobald das Echo-Signal wieder am Sensor ankommt. Dies hat zwangsweise die Folge, dass ich die Zeit für den Hin- und Rückweg habe. Für die Berechnung des Abstandes brauche ich allerdings nur die Zeit, die für einen der beide Wege benötigt wird - also die hälfte des Weges. Um dies zu erreichen wird die Laufzeit einfach halbiert.</p>

<h2>
<a id="aufbau-der-hardware" class="anchor" href="#aufbau-der-hardware" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aufbau der Hardware:</h2>

<h3>
<a id="hc-sr04-ultraschall-sensor" class="anchor" href="#hc-sr04-ultraschall-sensor" aria-hidden="true"><span class="octicon octicon-link"></span></a>HC-SR04 Ultraschall-Sensor:</h3>

<p><img src="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/raw/master/Bilder/HC-SR04.jpg" alt="Ultraschall Sensor"> </p>

<h4>
<a id="anschlüsse" class="anchor" href="#anschl%C3%BCsse" aria-hidden="true"><span class="octicon octicon-link"></span></a>Anschlüsse:</h4>

<ol>
<li>Vcc (+5V)</li>
<li>Trigger</li>
<li>Echo</li>
<li>Gnd</li>
</ol>

<p>Auf Vcc liegt die +5V Versorgungsspannung und bei Gnd die Masse an. Über "Trigger" wird der Ultraschall-Impuls ausgelöst und über Echo erfolgt die Signalisierung des erfolgreichen Empfang des Ultraschall-Echos. </p>

<h3>
<a id="aufbau-der-schaltung" class="anchor" href="#aufbau-der-schaltung" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aufbau der Schaltung:</h3>

<p>Die 4 PINs des Ultraschall-Moduls müssen wie folgt mit dem RaspberryPi verbunden werden:</p>

<ul>
<li>Vcc an Pin 2 (Vcc +5V)</li>
<li>GND an Pin 6 (GND) </li>
<li>TRIG an Pin 12 (GPIO 18)</li>
<li>An ECHO wird der 330Ω Widerstand angeschlossen. Vom Ende des Widerstands geht eine Verbindung zu Pin 18 (GPIO 24) und über den 470Ω eine Verbindung zu Pin 6 (GND).</li>
</ul>

<h5>
<a id="bitte-unbedingt-beachten" class="anchor" href="#bitte-unbedingt-beachten" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bitte unbedingt beachten:</h5>

<p>Das HC-SR04 Modul darf auf keinen Fall direkt mit dem RaspberryPi verbunden werden. Das Ultraschall-Modul arbeitet mit einer Spannung von 5v, während die GPIO Ports des RaspberryPi nur 3.3V vertragen. Ohne einen Spannungsteiler am ECHO-Ausgang wird beim RaspberryPi daher der GPIO Eingang zerstört. Aus diesem Grund ist unbedingt der Widerstand R1 mit 330Ω notwendig. </p>

<h3>
<a id="schaltbild-auf-dem-steckboard-breadboard" class="anchor" href="#schaltbild-auf-dem-steckboard-breadboard" aria-hidden="true"><span class="octicon octicon-link"></span></a>Schaltbild auf dem Steckboard (Breadboard):</h3>

<p><img src="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/raw/master/Schaltplan/Schaltplan.png" alt="Breadboard"> </p>

<p>Downloads-URLs für den Schaltplan in verschiedene Formate: </p>

<ul>
<li><a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/raw/master/Schaltplan/Schaltplan.pdf">PDF Datei</a></li>
<li><a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/raw/master/Schaltplan/Schaltplan.fzz">Fritzing</a></li>
</ul>

<h2>
<a id="aufbau-der-software" class="anchor" href="#aufbau-der-software" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aufbau der Software</h2>

<p>Für den RaspberryPi wird empfiehlt sich Raspbian als System zu verwenden, welches über z.B. über <a href="https://www.raspberrypi.org/downloads/">NOOB</a> installiert werden kann. Mittels eines Python-Scripts  kann die Messung durchgeführt werden.</p>

<h4>
<a id="python-script-getdistancepy" class="anchor" href="#python-script-getdistancepy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Python-Script "getDistance.py"</h4>

<div class="highlight highlight-python"><pre><span class="pl-c">#!/usr/bin/env python</span>
<span class="pl-c"># -*- coding: utf-8 -*-</span>

<span class="pl-c"># Entfernungsmesser für RaspberryPi</span>
<span class="pl-c"># Version 1.0</span>
<span class="pl-c">#</span>
<span class="pl-c"># Copyright: tfnApps.de Jens Dutzi</span>
<span class="pl-c"># Datum: 27.06.2015</span>
<span class="pl-c"># Lizenz: MIT Lizenz (siehe LICENSE)</span>
<span class="pl-c"># -----------------------------------</span>


<span class="pl-c"># import required modules</span>
<span class="pl-k">import</span> time
<span class="pl-k">import</span> RPi.GPIO <span class="pl-k">as</span> GPIO

<span class="pl-c"># define GPIO pins</span>
GPIOTrigger <span class="pl-k">=</span> <span class="pl-c1">18</span>
GPIOEcho    <span class="pl-k">=</span> <span class="pl-c1">24</span>

<span class="pl-c"># Funktion zum messen der Entfernung</span>
<span class="pl-k">def</span> <span class="pl-en">MesseDistanz</span>():
    <span class="pl-c"># Trigger auf "high" setzen (Signal senden)</span>
    GPIO.output(GPIOTrigger, <span class="pl-c1">True</span>)

    <span class="pl-c"># Signal für 10µs senden (ggf. je nach RaspberryPi auf 0.0005 setzen)</span>
    time.sleep(<span class="pl-c1">0.00001</span>)

    <span class="pl-c"># Trigger auf "low setzen (Signal beenden)</span>
    GPIO.output(GPIOTrigger, <span class="pl-c1">False</span>)

    <span class="pl-c"># Aktuelle Zeit setzen</span>
    StartZeit <span class="pl-k">=</span> time.time()
    StopZeit <span class="pl-k">=</span> StartZeit

    <span class="pl-c"># Warte bis "Echo" auf "low" gesetzt wird und setze danach Start-Zeit erneut</span>
    <span class="pl-k">while</span> GPIO.input(GPIOEcho) <span class="pl-k">==</span> <span class="pl-c1">0</span>:
        StartZeit <span class="pl-k">=</span> time.time()

    <span class="pl-c"># Warte bis "Echo" auf "high" wechselt (Signal wird empfangen) und setze End-Zeit</span>
    <span class="pl-k">while</span> GPIO.input(GPIOEcho) <span class="pl-k">==</span> <span class="pl-c1">1</span>:
        StopZeit <span class="pl-k">=</span> time.time()

    <span class="pl-c"># Abstand anhand der Signal-Laufzeit berechnen</span>
    <span class="pl-c"># Schallgeschwindigkeit: 343,50 m/s (bei 20°C Lufttemperatur)</span>
    <span class="pl-c"># Formel: /Signallaufzeit in Sekunden * Schallgeschwindigket in cm/s) / 2 (wg. Hin- und Rückweg des Signals)</span>
    SignalLaufzeit <span class="pl-k">=</span> StopZeit <span class="pl-k">-</span> StartZeit
    Distanz <span class="pl-k">=</span> (SignalLaufzeit<span class="pl-k">/</span><span class="pl-c1">2</span>) <span class="pl-k">*</span> <span class="pl-c1">34350</span>

    <span class="pl-k">return</span> [Distanz, (SignalLaufzeit<span class="pl-k">*</span><span class="pl-c1">1000</span><span class="pl-k">/</span><span class="pl-c1">2</span>)]

<span class="pl-c"># main function</span>
<span class="pl-k">def</span> <span class="pl-en">main</span>():
    <span class="pl-k">try</span>:
        <span class="pl-k">while</span> <span class="pl-c1">True</span>:
            Ergebnis <span class="pl-k">=</span> MesseDistanz()
            <span class="pl-k">print</span>(<span class="pl-s"><span class="pl-pds">"</span>Gemessene Entfernung: <span class="pl-c1">%.1f</span> cm (Signallaufzeit: <span class="pl-c1">%.4f</span>ms)<span class="pl-pds">"</span></span> <span class="pl-k">%</span> (Ergebnis[<span class="pl-c1">0</span>], Ergebnis[<span class="pl-c1">1</span>]))
            time.sleep(<span class="pl-c1">1</span>)

    <span class="pl-c"># reset GPIO settings if user pressed Ctrl+C</span>
    <span class="pl-k">except</span> <span class="pl-c1">KeyboardInterrupt</span>:
        <span class="pl-k">print</span>(<span class="pl-s"><span class="pl-pds">"</span>Messung abgebrochen<span class="pl-pds">"</span></span>)
        GPIO.cleanup()

<span class="pl-k">if</span> <span class="pl-c1">__name__</span> <span class="pl-k">==</span> <span class="pl-s"><span class="pl-pds">'</span>__main__<span class="pl-pds">'</span></span>:
    <span class="pl-c"># benutze GPIO Pin Nummerierung-Standard (Broadcom SOC channel)</span>
    GPIO.setmode(GPIO.BCM)

    <span class="pl-c"># Initialisiere GPIO Ports</span>
    GPIO.setup(GPIOTrigger, GPIO.OUT)
    GPIO.setup(GPIOEcho, GPIO.IN)

    <span class="pl-c"># Setze GPIO Trigger auf false</span>
    GPIO.output(GPIOTrigger, <span class="pl-c1">False</span>)

    <span class="pl-c"># Main-Funktion starten</span>
    main()</pre></div>

<p>Download: <a href="https://raw.githubusercontent.com/Blog404DE/RasPiUltraschallEntfernungsmesser/master/Code/getDistance.py">getDistance.py</a></p>

<h3>
<a id="wie-führe-ich-eine-messung-aus" class="anchor" href="#wie-f%C3%BChre-ich-eine-messung-aus" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wie führe ich eine Messung aus?</h3>

<p>Nachdem Sie das Script auf Ihren RaspberryPi geladen haben, können Sie es direkt mittels folgendem Befehl aufrufen. Bitte beachten Sie, dass der Zugriff auf die GPIO Ports nur als <em>root</em> möglich ist:</p>

<blockquote>
<p>root@raspberrypi:~# python getDistance.py</p>
</blockquote>

<p>Alternativ können Sie getDistance.py auch direkt ausführbar machen und sich das "python" beim aufrufen sparen. Hierzu ist nur folgendes notwendig:</p>

<blockquote>
<p>root@raspberrypi:~# chmod +x getDistance.py</p>
</blockquote>

<p>Die Ausgabe des Python Scripts sieht wie folgt aus:</p>

<pre><code>root@raspberrypi:~# ./entfernung.py
Gemessene Entfernung: 22.5 cm (Signallaufzeit: 0.6559ms)
Gemessene Entfernung: 22.9 cm (Signallaufzeit: 0.6690ms)
Gemessene Entfernung: 22.9 cm (Signallaufzeit: 0.6690ms)
Gemessene Entfernung: 22.5 cm (Signallaufzeit: 0.6560ms)
Gemessene Entfernung: 22.9 cm (Signallaufzeit: 0.6670ms)
</code></pre>

<p>Das Programm ermittelt kontinuierlich den Abstand und kann mittels <em>STRG+C</em> beendet werden. </p>

<hr>

<p><strong>Lizenz-Information:</strong></p>

<p>Copyright Jens Dutzi 2015 / Stand: 12.07.2015</p>

<p>Dieses Werk ist lizenziert unter der <a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser/blob/master/LICENSE">MIT Lizenz</a>.</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Blog404DE/RasPiUltraschallEntfernungsmesser">Rasberry Pi Ultraschall-Entfernungsmesser</a> is maintained by <a href="https://github.com/Blog404DE">Blog404DE</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-571228-17");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>

